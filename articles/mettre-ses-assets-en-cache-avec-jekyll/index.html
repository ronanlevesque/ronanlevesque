<!DOCTYPE html>
<html lang="fr" class="no-js">

<head>
  <meta charset="UTF-8" />
  <title>Ronan Levesque &ndash; Mettre ses assets en cache avec Jekyll</title>
  <meta name="description" content="Cet article montre une astuce toute simple que j'utilise pour contourner les problèmes de cache que l'on peut rencontrer sur Jekyll avec différents assets." />
  <meta name="author" content="Ronan Levesque" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Ronan Levesque" />
  <meta property="og:title" content="Mettre ses assets en cache avec Jekyll" />
  <meta property="og:description" content="Cet article montre une astuce toute simple que j'utilise pour contourner les problèmes de cache que l'on peut rencontrer sur Jekyll avec différents assets." />
  <meta property="og:url" content="http://ronanlevesque.fr/articles/mettre-ses-assets-en-cache-avec-jekyll/" />
  <link rel="dns-prefetch" href="//www.google-analytics.com" />
  <link rel="dns-prefetch" href="//fonts.googleapis.com" />
  <link href="/assets/css/styles-7a995b9e9ff57c24c368d7926d34a8bd.css" rel="stylesheet" />
  <link href='https://fonts.googleapis.com/css?family=Playfair+Display:400italic,700%7CFira+Sans:400,400italic,700%7CFira+Mono:400,700' rel='stylesheet' type='text/css' />
  <link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180x180.png" />
  <link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/favicons/favicon-194x194.png" sizes="194x194" />
  <link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/png" href="/favicons/android-chrome-192x192.png" sizes="192x192" />
  <link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16" />
  <link rel="manifest" href="/favicons/manifest.json" />
  <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5" />
  <link rel="shortcut icon" href="/favicons/favicon.ico" />
  <meta name="msapplication-TileColor" content="#343838" />
  <meta name="msapplication-TileImage" content="/favicons/mstile-144x144.png" />
  <meta name="msapplication-config" content="/favicons/browserconfig.xml" />
  <meta name="theme-color" content="#ffffff" />
  <script>
    document.documentElement.className = document.documentElement.className.replace(/(\s|^)no-js(\s|$)/, '$1js$2');
    if (localStorage.getItem('fontsLoaded')) { document.documentElement.className += ' fonts-loaded'; }
  </script>
</head>


<body id="top">



  <div class="js-content">
    <div class="wrapper">
        <header class="mainHeader">
    <div class="mainHeader-logo">
      <a href="/">
        <svg class="logo -header" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200.003 200.003"><path fill="#f45858" d="M0 200.003V0h200.003v200.003H0zm32.206-43.22h69.816v-44.457h8.694c8.168 14.967 16.288 29.842 24.266 44.458h32.442l-29.188-48.008c15.59-6.675 22.125-14.804 23.02-28.047 1.174-17.415-7.585-30.084-24.567-34.44-6.053-1.553-12.474-2.124-18.746-2.264-14.3-.322-28.613-.102-43.577-.102v86.617h-42.16v26.244z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#fff" d="M32.206 156.784v-26.242h42.16V43.925c14.965 0 29.277-.22 43.578.102 6.272.14 12.693.71 18.745 2.264 16.98 4.356 25.74 17.026 24.565 34.44-.894 13.243-7.428 21.372-23.02 28.047l29.19 48.008H134.98c-7.978-14.616-16.098-29.49-24.266-44.458h-8.694v44.458H32.206zm69.767-65.03c8.372.24 16.34.83 24.032-1.815 5.438-1.87 8.124-5.945 7.958-11.332-.156-5.046-3.123-8.854-8.62-10.223-7.636-1.9-15.405-1.27-23.37-1.063v24.43z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#f45858" d="M101.973 91.753V67.32c7.965-.204 15.734-.836 23.37 1.064 5.497 1.37 8.464 5.177 8.62 10.223.166 5.387-2.52 9.46-7.958 11.33-7.692 2.647-15.66 2.057-24.032 1.816z"/></svg>
      </a>
    </div>
    <nav class="mainNav">
        <ul class="mainNav-list">
          
          <li class="mainNav-item"><a href="/projets/" class="mainNav-link">Projets</a></li>
          <li class="mainNav-item"><a href="/articles/" class="mainNav-link selected">Articles</a></li>
          <li class="mainNav-item"><a href="/a-propos/" class="mainNav-link">A propos</a></li>
        </ul>
    </nav>
  </header>

      
      <article class="article">
      
        <header class="article-header">
          <time class="article-date">17 décembre 2014</time>
          <h1 class="article-title">Mettre ses assets en cache avec Jekyll</h1>
        </header>
        
        <div class="article-content">
        
          <p>Je partage aujourd’hui une solution assez simple que l’on peut mettre en place avec Jekyll pour générer une unique ID utilisable sur nos assets pour contourner les éventuels problèmes de cache, et ainsi faire en sorte que les différents assets que l’on utilise soient correctement mis à jour.</p>

<hr />

<p class="info">Mise à jour (01/07/2015) : depuis l'écriture de cette article, j'ai mis en place un système bien plus pertinent que je détaille ci-dessous.</p>

<hr />

<h2 id="lancienne-solution">L’ancienne solution</h2>

<p>Celle-ci se base sur les formats date du système de templating <a href="http://liquidmarkup.org/">liquid</a> pour générer une ID. Ainsi, au lieu de :</p>

<pre><code class="html">&lt;link rel="stylesheet" href="/css/myawesomestylesheet.css"&gt;</code></pre>

<p>Il nous suffira d’utiliser :</p>

<pre><code class="html">&lt;link rel="stylesheet" href="/css/myawesomestylesheet.css?v=&#123;&#123; site.time | date: '%y%m%d%k%M%S' &#125;&#125;"&gt;</code></pre>

<p>Ce qui générera, dans l’ordre : l’année, le mois, le jour, et l’heure avec minutes et secondes. Ainsi le résultat obtenu sera de ce type :</p>

<pre><code class="html">&lt;link rel="stylesheet" href="/css/myawesomestylesheet.css?v=141217192112"&gt;</code></pre>

<p>De cette manière, on est sûr d’avoir une ID <em>presque</em> unique puisqu’à chaque seconde passée elle sera différente.</p>

<h2 id="les-limites-de-cette-solution">Les limites de cette solution</h2>

<p>En appliquant cette façon de faire, tous les fichiers HTML seront mis à jour avec une nouvelle version du CSS, même si celui-ci n’a pas changé. La mise en cache perd un peu de son intérêt… Autre argument, Google <a href="https://developers.google.com/speed/docs/insights/LeverageBrowserCaching">conseille</a> d’éviter les <em>query parameters</em> au profit des <em>fingerprints</em>.</p>

<h2 id="un-autre-système">Un autre système</h2>

<p>Je suis allé chercher du côté des plugins Jekyll et j’ai déniché <a href="https://github.com/tkareine/jekyll-minibundle">Jekyll-minibundle</a>, qui fait exactement ce que je cherche. Une fois le plugin installé, les <em>fingerprints</em> s’ajoutent de cette manière :</p>

<pre class="html"><code>&lt;link href="&#123;&#37; ministamp /_assets/css/fox.css /assets/css/fox.css &#37;&#125;" rel="stylesheet"&gt;</code></pre>

<p>Le premier lien est le fichier source, le deuxième est le fichier de destination. Le code généré donne ça :</p>

<pre class="html"><code>&lt;link href="/assets/css/fox-86e4c5e39ca8a41719996d783a87c702.css" rel="stylesheet"&gt;</code></pre>

        </div>
      </article>
        
  <footer class="mainFooter">
  
    <svg class="logo -footer" viewBox="0 0 136 114" xmlns="http://www.w3.org/2000/svg"><path d="M.206 113.784V87.542h42.16V.925c14.965 0 29.277-.22 43.578.102 6.272.14 12.693.71 18.745 2.264 16.98 4.356 25.74 17.026 24.565 34.44-.894 13.243-7.428 21.372-23.02 28.047l29.19 48.008H102.98c-7.978-14.616-16.098-29.49-24.266-44.458h-8.694v44.458H.206zm69.767-65.03c8.372.24 16.34.83 24.032-1.815 5.438-1.87 8.124-5.945 7.958-11.332-.156-5.046-3.123-8.854-8.62-10.223-7.636-1.9-15.405-1.27-23.37-1.063v24.43z" fill="#f45858" fill-rule="evenodd"/></svg>
  </footer>

    </div>
  </div>

  <script src="/assets/js/bundle-813ef0093ffb9aea8484e28d6257b967.js"></script>
  </body>
</html>

