<!DOCTYPE html>
<html lang="fr" class="no-js">

<head>
  <meta charset="UTF-8" />
  <title>Ronan Levesque &ndash; Mettre ses assets en cache avec Jekyll</title>
  <meta name="description" content="Cet article montre une astuce toute simple que j&#39;utilise pour contourner les problèmes de cache que l&#39;on peut rencontrer sur Jekyll avec différents assets." />
  <meta name="author" content="Ronan Levesque" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Ronan Levesque" />
  <meta property="og:title" content="Mettre ses assets en cache avec Jekyll" />
  <meta property="og:description" content="Cet article montre une astuce toute simple que j&#39;utilise pour contourner les problèmes de cache que l&#39;on peut rencontrer sur Jekyll avec différents assets." />
  <link rel="dns-prefetch" href="//www.google-analytics.com" />
  <link rel="dns-prefetch" href="//fonts.googleapis.com" />
  <link rel="stylesheet" href="/assets/css/main-fa3f3e6c.css" />
  <link href="https://fonts.googleapis.com/css?family=Dosis:700%7CRoboto+Mono:400,700%7CRoboto:400,400i,700" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
  <link rel="manifest" href="/favicons/manifest.json">
  <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#0d2c54">
  <link rel="shortcut icon" href="/favicons/favicon.ico">
  <meta name="msapplication-config" content="/favicons/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
  <script>
    document.documentElement.className = document.documentElement.className.replace(/(\s|^)no-js(\s|$)/, '$1js$2');
    if (localStorage.getItem('fontsLoaded')) { document.documentElement.className += ' fonts-loaded'; }
  </script>
</head>

<body>


<div class="Wrapper">
  <header class="MainHeader">
  <a href="/" class="MainHeader-logo">
    <svg class="Logo" viewBox="0 0 136 114" xmlns="http://www.w3.org/2000/svg"><title>Logo Ronan Levesque</title><path d="M.206 113.784V87.542h42.16V.925c14.965 0 29.277-.22 43.578.102 6.272.14 12.693.71 18.745 2.264 16.98 4.356 25.74 17.026 24.565 34.44-.894 13.243-7.428 21.372-23.02 28.047l29.19 48.008H102.98c-7.978-14.616-16.098-29.49-24.266-44.458h-8.694v44.458H.206zm69.767-65.03c8.372.24 16.34.83 24.032-1.815 5.438-1.87 8.124-5.945 7.958-11.332-.156-5.046-3.123-8.854-8.62-10.223-7.636-1.9-15.405-1.27-23.37-1.063v24.43z" fill="#2AFC98" fill-rule="evenodd"/></svg>
  </a>
  <nav class="NavBar">
    <ul class="NavBar-list">
      <li class="NavBar-item">
        <a href="/articles/" class="NavBar-link -selected">Articles</a>
      </li>
      <li class="NavBar-item">
        <a href="/projets/" class="NavBar-link">Projets</a>
      </li>
      <li class="NavBar-item">
        <a href="/a-propos/" class="NavBar-link">À propos</a>
      </li>
    </ul>
  </nav>
</header>

  <main>
    <article class="Article">
      <header class="Article-header">
        <time class="Article-date">17 décembre 2014</time>
        <h1 class="Article-title">Mettre ses assets en cache avec Jekyll</h1>
      </header>
      <div class="Article-content  -articlePage">
        

<p>Je partage aujourd&rsquo;hui une solution assez simple que l&rsquo;on peut mettre en place avec Jekyll pour générer une unique ID utilisable sur nos assets pour contourner les éventuels problèmes de cache, et ainsi faire en sorte que les différents assets que l&rsquo;on utilise soient correctement mis à jour.</p>

<hr />

<p class="info">Mise à jour (01/07/2015) : depuis l'écriture de cette article, j'ai mis en place un système bien plus pertinent que je détaille ci-dessous.</p>

<hr />

<h2 id="l-ancienne-solution">L&rsquo;ancienne solution</h2>

<p>Celle-ci se base sur les formats date du système de templating <a href="http://liquidmarkup.org/">liquid</a> pour générer une ID. Ainsi, au lieu de :</p>

<pre><code class="html">&lt;link rel="stylesheet" href="/css/myawesomestylesheet.css"&gt;</code></pre>

<p>Il nous suffira d&rsquo;utiliser :</p>

<pre><code class="html">&lt;link rel="stylesheet" href="/css/myawesomestylesheet.css?v=&#123;&#123; site.time | date: '%y%m%d%k%M%S' &#125;&#125;"&gt;</code></pre>

<p>Ce qui générera, dans l&rsquo;ordre : l&rsquo;année, le mois, le jour, et l&rsquo;heure avec minutes et secondes. Ainsi le résultat obtenu sera de ce type :</p>

<pre><code class="html">&lt;link rel="stylesheet" href="/css/myawesomestylesheet.css?v=141217192112"&gt;</code></pre>

<p>De cette manière, on est sûr d&rsquo;avoir une ID <em>presque</em> unique puisqu&rsquo;à chaque seconde passée elle sera différente.</p>

<h2 id="les-limites-de-cette-solution">Les limites de cette solution</h2>

<p>En appliquant cette façon de faire, tous les fichiers HTML seront mis à jour avec une nouvelle version du CSS, même si celui-ci n&rsquo;a pas changé. La mise en cache perd un peu de son intérêt&hellip; Autre argument, Google <a href="https://developers.google.com/speed/docs/insights/LeverageBrowserCaching">conseille</a> d&rsquo;éviter les <em>query parameters</em> au profit des <em>fingerprints</em>.</p>

<h2 id="un-autre-système">Un autre système</h2>

<p>Je suis allé chercher du côté des plugins Jekyll et j&rsquo;ai déniché <a href="https://github.com/tkareine/jekyll-minibundle">Jekyll-minibundle</a>, qui fait exactement ce que je cherche. Une fois le plugin installé, les <em>fingerprints</em> s&rsquo;ajoutent de cette manière :</p>

<pre class="html"><code>&lt;link href="&#123;&#37; ministamp /_assets/css/fox.css /assets/css/fox.css &#37;&#125;" rel="stylesheet"&gt;</code></pre>

<p>Le premier lien est le fichier source, le deuxième est le fichier de destination. Le code généré donne ça :</p>

<pre class="html"><code>&lt;link href="/assets/css/fox-86e4c5e39ca8a41719996d783a87c702.css" rel="stylesheet"&gt;</code></pre>

      </div>
    </article>
  </main>
</div>


  <script src="/assets/js/bundle-3f973440.js"></script>
</body>

</html>

