<!DOCTYPE html>
<!--[if lte IE 7]> <html class="ie7 no-js" lang="fr"> <![endif]-->
<!--[if IE 8]> <html class="ie8 no-js" lang="fr"> <![endif]-->
<!--[if IE 9]> <html class="ie9 no-js" lang="fr"> <![endif]-->
<html lang="fr" class="no-js">
<head>
	<meta charset="UTF-8">
	<title>Ronan Levesque - Animations en CSS : un cas pratique</title>
	<!-- Remove this if Modernizr is used -->
	<script>document.documentElement.className = document.documentElement.className.replace(/(\s|^)no-js(\s|$)/, '$1js$2');</script>
	<meta name="description" content="Exemple d'animation d'une bannière grâce à CSS3">
	<meta name="author" content="Ronan Levesque">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!--[if lte IE 8]><link rel="stylesheet" href="/css/fox-ie.css"><![endif]-->
	<!--[if gt IE 8]><!--><link rel="stylesheet" href="/css/fox.css"><!--<![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Merriweather:400,400italic,700%7CMerriweather+Sans:400,800' rel='stylesheet' type='text/css'>
	<!--[if (gte IE 6)&(lte IE 8)]>
	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
 	<![endif]-->
</head>

<body>

	<header class="main-header" role="banner">
		<div class="main-header__inner">
			<div class="main-header__left">
				<a href="/" class="logo"><img src="/img/logo-ronan-levesque.svg" alt="Logo Ronan Levesque"></a>
			</div><!--
			--><div class="main-header__right">
				<a href="#" class="nav-mobile" data-state="closed">Menu</a>
			</div><!--
			--><nav class="main-nav" role="navigation">
				<ul data-state="closed">
					<li><a href="/projets">Projets</a></li><!--
					--><li><a href="/articles" class="selected">Articles</a></li><!--
					--><li><a href="/a-propos">A propos</a></li><!--
					--><li><a href="/contact">Contact</a></li>
				</ul>
			</nav>
		</div>
	</header>
	<main role="main">
		<article>
		  <div class="article__inner">
				<p class="article__date">Le 07 Mai 2013</p>
				<h1>Animations en CSS : un cas pratique</h1>
				<p>J&#39;avais posté il y a quelques temps un bref <a href="http://ronanlevesque.fr/les-animations-en-css/">tutoriel</a> sur les animations en CSS. Depuis je n&#39;avais pas vraiment creusé la question, mais en refaisant le site récemment j&#39;ai décidé d&#39;ajouter un peu de vie dans la bannière, en faisant bouger quelques-uns des éléments du paysage (nuage, fumée de l&#39;usine, drapeau et montgolfière). L&#39;idée ici est de montrer comment ça fonctionne, concrètement.</p>

<p class="credits">Mise à jour (04/06/2013) : j'ai changé le header de mon site depuis, mais j'ai laissé un <a href="/old/old5/page.html">exemple</a> en ligne.</p>

<p class="credits">Attention, comme pour le tuto précédent, dans les exemples qui suivent je n'ai rien préfixé pour plus de simplicité.</p>

<h2>Les animations en détail</h2>

<h3>Les nuages</h3>

<p>La première des animations sur laquelle j&#39;ai travaillé était de faire bouger les nuages comme si ils étaient mûs par un vent d&#39;ouest (de gauche). Il existe deux méthodes pour faire bouger des éléments :</p>

<ol>
<li>Avec les propriétés <code>translate()</code>, <code>translateX()</code> et <code>translateY()</code></li>
<li>En utilisant <code>position:absolute</code> et <code>left</code>, <code>right</code>, <code>top</code>, <code>bottom</code>.</li>
</ol>

<p>Il semblerait que la première solution soit celle à privilégier pour des <a href="http://paulirish.com/2012/why-moving-elements-with-translate-is-better-than-posabs-topleft/">soucis de performance <sup>EN</sup></a>. Le hic, c&#39;est que <code>translate()</code> ne bouge l&#39;élément que par rapport à sa position originale. Ça me posait un souci car dans ce cas, impossible d&#39;avoir un contrôle précis de la position de l&#39;élément par rapport à la fenêtre du navigateur. J&#39;ai donc eu recours à la deuxième solution, en utilisant le <code>@keyframes</code> suivant :</p>

<pre class="pre-css prettyprint">@keyframes nuage1 {
  from {left: -200px;}
  to {left: 100%;}
}</pre>

<p>De cette façon, mon nuage apparaîtra à chaque fois à 200px du bord gauche de ma fenêtre et se repositionnera bien après être arrivé à 100%. J&#39;ai ensuite attribué plusieurs vitesses à chacun de mes nuages pour leur donner un effet plus réaliste, par exemple :</p>

<pre class="pre-css prettyprint">.nuage1 {
  animation: nuage1 32s linear infinite;
}</pre>

<p>Les animations des nuages saccadent légèrement sur Chrome, mais sur Firefox et IE10 c&#39;est plutôt fluide, d&#39;après ce que j&#39;ai testé.</p>

<p class="credits">Mise à jour (11/05/2013) : en testant le site sur iPad je me suis rendu compte que l'animation ne marchait pas du tout : les nuages restent collés à 100% de leur position, sans bouger. Je creuserai la question plus tard, en attendant j'ai désactivé leurs animations.</p>

<h3>La montgolfière</h3>

<p>Là, contrairement aux nuages, la montgolfière ne bouge que par rapport à sa position d&#39;origine, l&#39;idée étant de lui donner un léger effet &quot;flottant&quot; de haut en bas. J&#39;ai donc pu utiliser <code>translateY()</code> pour arriver à ce résultat :</p>

<pre class="pre-css prettyprint">@keyframes montgolfiere {
  50% {transform: translateY(10px);}
}</pre>

<p>A noter qu&#39;un simple ligne revient ici au même résultat que si l&#39;on avait défini trois étapes à 0, 50 et 100% de notre <code>@keyframes</code>, l&#39;idée étant de faire revenir l&#39;élément à sa position de départ.</p>

<h3>La fumée</h3>

<p>Ici, même principe que pour l&#39;animation de la montgolfière : la fumée se déplacera à chaque fois par rapport à sa position initiale. J&#39;ai également ajouté un effet d&#39;opacité, pour la rendre un peu plus réaliste. Le code est le suivant :</p>

<pre class="pre-css prettyprint">@keyframes fumee {
  from {transform: translate(0px, 0px); opacity: 0;}
  50% {transform: translate(7px, -7px); opacity: 1;}
  to {transform: translate(20px, -20px); opacity: 0;}
}</pre>

<p>Arrivée à 100% de l&#39;animation, la fumée repartira de son point de départ.</p>

<h3>Le drapeau</h3>

<p>Pour donner l&#39;impression que le drapeau flotte au vent, c&#39;est plutôt simple : il suffit de changer sa <code>width</code> dans le temps, de la manière suivante :</p>

<pre class="pre-css prettyprint">@keyframes flag {
  50% {width: 4px;}
}</pre>

<p>Le drapeau passera de 7 à 4px en boucle, donnant ainsi l&#39;impression qu&#39;il bouge.</p>

<h2>Problèmes rencontrés</h2>

<p>Les animations n&#39;ont rien de sorcier, elles sont simples à utiliser une fois qu&#39;on a saisi le concept de départ. J&#39;ai juste rencontré deux problèmes lors de leur conception...</p>

<p>Tout d&#39;abord, sur Firefox et IE10, les animations de la fumée et de la montgolfière sont légèrement saccadées, contrairement à Chrome. En fait ce dernier semble lisser les animations d&#39;un pixel à un autre, ce qui rend l&#39;image légèrement floue mais donne un meilleur rendu final. Les deux autres navigateurs déplacent l&#39;image pixel par pixel, le rendu est légèrement moins esthétique à mon goût... Mais à ma connaissance on ne peut malheureusement pas y faire grand chose.</p>

<p>Ensuite, après avoir bouclé mes animations, j&#39;ai testé tout ça sur Firefox (niquel), puis sur Chrome (niquel), et arrivé sur IE10 : rien ne se passe. Un peu bizarre, IE10 gère normalement très bien les animations, et ce sans avoir besoin de les préfixer. Après avoir vérifié et revérifié la syntaxe, fait quelques tests supplémentaires, et m&#39;être arraché un ou deux cheveux, j&#39;ai trouvé la solution : en fait j&#39;ai créé deux feuilles de styles pour mon site, style.css et expand.css. La deuxième utilise un <code>media</code> avec une <code>(min-width: 35em)</code>. Mes <code>@keyframes</code> étaient situées dans expand.css : dès que je les ai déplacés dans style.css, les animations se sont remises à marcher. Je n&#39;ai aucune idée de la raison pour laquelle IE10 bloque les animations lorsque celles-ci sont contenues dans une feuille de style d&#39;une taille spécifique, mais au moins je sais comment corriger ça maintenant :)</p>

<h2>Fallbacks possibles</h2>

<p>J&#39;ai utilisé un fallback simple pour que le rendu reste agréable sur les navigateurs ne supportant pas les <code>@keyframes</code> : les nuages, fumée et montgolfière sont définis dès le départ en position absolue. Ils seront simplement fixes.</p>

        <div class="article__footer">
          <p class="article__share">Cet article vous a plu ? Partagez-le :
            <span class="social">
              <a href="http://twitter.com/home?status=Animations en CSS : un cas pratique http://ronanlevesque.fr/articles/les-animations-en-css-un-cas-pratique" class="twitter">
                <img src="/img/twitter-bw.svg" alt="Partager sur Twitter">
                <img src="/img/twitter.svg" class="bw-hover" alt="Partager sur Twitter">
              </a>
              <a href="https://plus.google.com/share?url=http://ronanlevesque.fr/articles/les-animations-en-css-un-cas-pratique" class="google">
                <img src="/img/google-bw.svg" alt="Partager sur Google+">
                <img src="/img/google.svg" class="bw-hover" alt="Partager sur Google+">
              </a>
              <a href="http://www.facebook.com/sharer.php?s=100&amp;p[url]=http://ronanlevesque.fr/articles/les-animations-en-css-un-cas-pratique&amp;p[title]=Animations en CSS : un cas pratique" class="facebook">
                <img src="/img/facebook-bw.svg" alt="Partager sur Facebook">
                <img src="/img/facebook.svg" class="bw-hover" alt="Partager sur Facebook">
              </a>
            </span>
          </p>
        </div>
			</div>
		</article>
	</main>
	<footer class="main-footer" role="contentinfo">
		<div class="main-footer__inner">
			<p class="main-footer__left">(c) Ronan Levesque 2014</p><!--
			--><div class="main-footer__right">
				<a href="https://twitter.com/ronanlevesque" class="twitter-follow-button" data-show-count="false" data-lang="fr" data-size="large">Suivre @ronanlevesque</a>
				<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
			</div>
		</div>
	</footer>
	<div class="spinner"></div>
  <!--[if (gte IE 6)&(lte IE 9)]>
 	<script src="/js/ie/matchmedia.js"></script>
 	<![endif]-->
	<script src="/js/main.js"></script>
	<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?autoload=true&amp;skin=desert"></script>
	<script>
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-29762874-1']);
		_gaq.push(['_trackPageview']);

		(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>
</body>
</html>

