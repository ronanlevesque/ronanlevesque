<!DOCTYPE html>
<html lang="fr" class="no-js">

<head>
  <meta charset="UTF-8">
  <title>Ronan Levesque - Une gestion responsable des webfonts</title>
  <meta name="description" content="Une solution mise en place pour éviter l'apparition d'un FOIT avec les webfonts">
  <meta name="author" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Ronan Levesque" />
  <meta property="og:title" content="Une gestion responsable des webfonts" />
  <meta property="og:description" content="Une solution mise en place pour éviter l'apparition d'un FOIT avec les webfonts">
  <meta property="og:url" content="http://ronanlevesque.fr/articles/une-gestion-responsable-des-webfonts" />
  <link rel="dns-prefetch" href="//www.google-analytics.com" />
  <link href="/assets/css/fox-ac92d5ad7d79085c9346bd5f43ae1d81.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <script>
    document.documentElement.className = document.documentElement.className.replace(/(\s|^)no-js(\s|$)/, '$1js$2');
    if (localStorage.getItem('ronanLevesqueFontsLoaded')) { document.documentElement.className += ' fonts-loaded'; }
  </script>
</head>
<body>
  <div class="wrapper" id="top">

    <nav class="main-nav" role="navigation">
      <div class="main-nav__top">
        <a href="/" class="main-nav__logo flip-container">
          <div class="flip">
            <svg class="front" xmlns="http://www.w3.org/2000/svg" width="200.003" height="200.003" viewBox="0 0 200.003 200.003"><path fill="#222" d="M0 200.003V0h200.003v200.003H0zm32.206-43.22h69.816v-44.457h8.694c8.168 14.967 16.288 29.842 24.266 44.458h32.442l-29.188-48.008c15.59-6.675 22.125-14.804 23.02-28.047 1.174-17.415-7.585-30.084-24.567-34.44-6.053-1.553-12.474-2.124-18.746-2.264-14.3-.322-28.613-.102-43.577-.102v86.617h-42.16v26.244z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#fff" d="M32.206 156.784v-26.242h42.16V43.925c14.965 0 29.277-.22 43.578.102 6.272.14 12.693.71 18.745 2.264 16.98 4.356 25.74 17.026 24.565 34.44-.894 13.243-7.428 21.372-23.02 28.047l29.19 48.008H134.98c-7.978-14.616-16.098-29.49-24.266-44.458h-8.694v44.458H32.206zm69.767-65.03c8.372.24 16.34.83 24.032-1.815 5.438-1.87 8.124-5.945 7.958-11.332-.156-5.046-3.123-8.854-8.62-10.223-7.636-1.9-15.405-1.27-23.37-1.063v24.43z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#222" d="M101.973 91.753V67.32c7.965-.204 15.734-.836 23.37 1.064 5.497 1.37 8.464 5.177 8.62 10.223.166 5.387-2.52 9.46-7.958 11.33-7.692 2.647-15.66 2.057-24.032 1.816z"/></svg>
            <svg class="back" width="200" height="200" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h200v200H0V0z" fill="#222"/><path d="M150.302 106.097v51.14h-36.54v-27.793H86.238v27.792H49.696v-51.14H36.62L100 42.765l63.38 63.333h-13.078zm-7.82-57.64h-14.744v11.786L142.48 75.02V48.455z" fill="#FFF"/></g></svg>
        </div>
        </a>
        <a href="/" class="main-nav__close">
          <svg width="205" height="205" viewBox="0 0 205 205" xmlns="http://www.w3.org/2000/svg"><g stroke="#ccc" stroke-width="16" stroke-linecap="square" fill="none" fill-rule="evenodd"><path d="M11 11l183 183M194.02 10.963l-183 183"/></g></svg>
        </a>
      </div>
      <ol class="main-nav__menu">
        
        <li><a href="/projets" >Projets</a></li>
        <li><a href="/articles" class="selected">Articles</a></li>
        <li><a href="/a-propos" >A propos</a></li>
      </ol>
    </nav>

    <main class="main-page" role="main">
      <header class="page-header">
        <div class="page-header__anim">
          <time class="page-header__date">25 juin 2015</time>
          <h1 class="page-header__title">Une gestion responsable des webfonts</h1>
        </div>
      </header>
      <article class="article">
        <p>Jusqu&#39;à très récemment, j&#39;avais tendance à gérer mes webfonts de manière basique en les appelant directement dans mon CSS, que ce soit via CDN (Google webfonts) ou en hébergement personnel. Mais cette manière de faire est propice à l&#39;apparition du FOIT, qui peut être très pénalisant selon les navigateurs. Voici une solution que j&#39;ai mise en place dernièrement, et dont je suis pleinement satisfait.</p>

<h2>Quelques précisions</h2>

<p>La notion de <em>FOIT</em> ne parlant pas à tout le monde, commençons par une petite explication : tant que votre navigateur n&#39;a pas téléchargé les <em>webfonts</em> de votre site, le texte ainsi stylé reste invisible pendant un certain temps avant que le navigateur décide d&#39;afficher les polices que vous avez définies par défaut. C&#39;est ce qu&#39;on appelle le <em>FOIT</em>, pour <em>Flash Of Invisible Text</em>.</p>

<p>Le problème, c&#39;est que ce temps varie selon les navigateurs; et s&#39;il reste raisonnable sur Chrome ou Firefox (de l&#39;ordre de 3 secondes), il peut aller jusqu&#39;à 30 secondes pour Safari iOS par exemple.</p>

<figure>
  <img src="/img/webfonts-invision.jpg" alt="Exemple de site avec FOIT">
  <figcaption>Exemple de FOIT : sur ce site, il m'a fallu une dizaine de secondes pour pouvoir accéder au contenu - malgré ma connexion en WiFi.</figcaption>
</figure>

<p>Si l&#39;on considère en outre qu&#39;un site doit en moyenne se charger en 1 seconde avec une connexion rapide, ne pas pouvoir accéder au contenu du site avant 3 secondes n&#39;est de toute façon pas l&#39;idéal.</p>

<h2>La solution au problème</h2>

<p><a href="http://crocodillon.com/blog/non-blocking-web-fonts-using-localstorage">Plusieurs</a> <a href="http://jaicab.com/localFont/">techniques</a> ont émergé récemment, mais celle qui a retenu mon attention est celle mise en place par <a href="https://www.filamentgroup.com/lab/font-events.html">filament group</a>.</p>

<p>L&#39;idée est d&#39;utiliser par défaut les polices <em>websafe</em> (cf. <a href="http://www.cssfontstack.com/">CSS Font Stack</a>) et de prévoir une classe contenant les <em>webfonts</em>, par exemple :</p>

<pre><code class="css">body {
  font-family: Sans-serif;
}

.font-loaded {
  font-family: 'Open Sans', Sans-serif;
}</code></pre>

<p>On utilise ensuite le loader JS <a href="https://github.com/bramstein/fontfaceobserver">Font Face Observer</a> créé par <a href="https://twitter.com/bram_stein">Bram Stein</a> pour détecter le moment où toutes les <em>webfonts</em> seront loadées, et une fois que c&#39;est fait on ajoute notre classe <code>font-loaded</code> :</p>

<pre><code class="js">(function(w) {
  if (w.document.documentElement.className.indexOf('fonts-loaded') > -1) {
    return;
  }
  var fontA = new w.FontFaceObserver('Open Sans', {
    weight: 300
  });
  var fontB = new w.FontFaceObserver('Open Sans', {
    weight: 300,
    style: 'italic'
  });
  w.Promise
  .all([fontA.check(), fontB.check()])
  .then(function() {
    w.document.documentElement.className += ' fonts-loaded';
    localStorage.setItem('fontsLoaded', true);
  });
}(this));</code></pre>

<p>L&#39;approche de filament group privilégie l&#39;utilisation de cookies, mais quant à moi j&#39;ai préféré me rabattre sur <em>localStorage</em>. On crée avec celui-ci un item <code>fontsLoaded</code> grâce auquel on pourra ajouter dans notre <code>&lt;head&gt;</code> la classe <code>fonts-loaded</code> à notre html, comme ceci :</p>

<pre><code class="html">&lt;script&gt;
  if (localStorage.getItem('fontsLoaded')) {
    document.documentElement.className += ' fonts-loaded';
  }
&lt;/script&gt;</code></pre>

<p>Ainsi, tant que cet item sera encore présent dans notre <em>localStorage</em>, la classe en question sera appliquée avant le rendu de la page.</p>

<h2>Une future alternative</h2>

<p>L&#39;approche décrite ici me paraît pour l&#39;instant la plus efficace, en attendant une meilleure solution... Celle-ci pourrait bien venir de la proposition <em>CSS font-rendering</em> dont le but est de contrôler directement via CSS le comportement d&#39;affichage de nos <em>webfonts</em>. Je vous invite à consulter son <a href="https://github.com/KenjiBaheux/css-font-rendering">repo Github</a> pour de plus amples informations.</p>

      </article>
    </main>
    <footer class="main-footer" role="contentinfo">
      <div class="main-footer__inner">
        <a href="#top" data-scroll data-options='{"updateURL": false}' class="main-footer__logo flip-container">
          <div class="flip">
            <svg class="front" xmlns="http://www.w3.org/2000/svg" width="200.003" height="200.003" viewBox="0 0 200.003 200.003"><path fill="#fff" d="M0 200.003V0h200.003v200.003H0zm32.206-43.22h69.816v-44.457h8.694c8.168 14.967 16.288 29.842 24.266 44.458h32.442l-29.188-48.008c15.59-6.675 22.125-14.804 23.02-28.047 1.174-17.415-7.585-30.084-24.567-34.44-6.053-1.553-12.474-2.124-18.746-2.264-14.3-.322-28.613-.102-43.577-.102v86.617h-42.16v26.244z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#222" d="M32.206 156.784v-26.242h42.16V43.925c14.965 0 29.277-.22 43.578.102 6.272.14 12.693.71 18.745 2.264 16.98 4.356 25.74 17.026 24.565 34.44-.894 13.243-7.428 21.372-23.02 28.047l29.19 48.008H134.98c-7.978-14.616-16.098-29.49-24.266-44.458h-8.694v44.458H32.206zm69.767-65.03c8.372.24 16.34.83 24.032-1.815 5.438-1.87 8.124-5.945 7.958-11.332-.156-5.046-3.123-8.854-8.62-10.223-7.636-1.9-15.405-1.27-23.37-1.063v24.43z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#fff" d="M101.973 91.753V67.32c7.965-.204 15.734-.836 23.37 1.064 5.497 1.37 8.464 5.177 8.62 10.223.166 5.387-2.52 9.46-7.958 11.33-7.692 2.647-15.66 2.057-24.032 1.816z"/></svg>
            <svg class="back" width="200" height="200" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h200v200H0V0z" fill="#FFF"/><path d="M158.308 118.845l-20.244 20.34L100 101.304l-38.064 37.883-20.244-20.34L100 60.813l58.308 58.03z" fill="#222"/></g></svg>
          </div>
        </a>
      </div>
    </footer>
  </div>
  <!--[if IE 9]> <script src="/ie/matchMedia.js"></script> <![endif]-->
  <script src="/assets/js/main-b3b52ec93889b00a3ee9d08401a40848.js"></script>
  <script>
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-29762874-1']);
    _gaq.push(['_trackPageview']);

    (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</body>
</html>

