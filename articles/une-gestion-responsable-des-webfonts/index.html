<!DOCTYPE html>
<html lang="fr" class="no-js">

<head>
  <meta charset="UTF-8" />
  <title>Ronan Levesque &ndash; Une gestion responsable des webfonts</title>
  <meta name="description" content="Une solution mise en place pour éviter l&#39;apparition d&#39;un FOIT avec les webfonts" />
  <meta name="author" content="Ronan Levesque" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Ronan Levesque" />
  <meta property="og:title" content="Une gestion responsable des webfonts" />
  <meta property="og:description" content="Une solution mise en place pour éviter l&#39;apparition d&#39;un FOIT avec les webfonts" />
  <link rel="dns-prefetch" href="//www.google-analytics.com" />
  <link rel="dns-prefetch" href="//fonts.googleapis.com" />
  <link rel="stylesheet" href="/assets/css/main-594f102e.css" />
  <link href="https://fonts.googleapis.com/css?family=Dosis:700|Roboto+Mono:400,700|Roboto:400,400i,700" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
  <link rel="manifest" href="/favicons/manifest.json">
  <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#0d2c54">
  <link rel="shortcut icon" href="/favicons/favicon.ico">
  <meta name="msapplication-config" content="/favicons/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
  <script>
    document.documentElement.className = document.documentElement.className.replace(/(\s|^)no-js(\s|$)/, '$1js$2');
    if (localStorage.getItem('fontsLoaded')) { document.documentElement.className += ' fonts-loaded'; }
  </script>
</head>

<body>


<div class="Wrapper">
  <header class="MainHeader">
  <a href="/" class="MainHeader-logo">
    <svg class="Logo" viewBox="0 0 136 114" xmlns="http://www.w3.org/2000/svg" title="Logo Ronan Levesque"><path d="M.206 113.784V87.542h42.16V.925c14.965 0 29.277-.22 43.578.102 6.272.14 12.693.71 18.745 2.264 16.98 4.356 25.74 17.026 24.565 34.44-.894 13.243-7.428 21.372-23.02 28.047l29.19 48.008H102.98c-7.978-14.616-16.098-29.49-24.266-44.458h-8.694v44.458H.206zm69.767-65.03c8.372.24 16.34.83 24.032-1.815 5.438-1.87 8.124-5.945 7.958-11.332-.156-5.046-3.123-8.854-8.62-10.223-7.636-1.9-15.405-1.27-23.37-1.063v24.43z" fill="#2AFC98" fill-rule="evenodd"/></svg>
  </a>
  <nav class="NavBar">
    <ul class="NavBar-list">
      <li class="NavBar-item">
        <a href="/articles/" class="NavBar-link -selected">Articles</a>
      </li>
      <li class="NavBar-item">
        <a href="/projets/" class="NavBar-link">Projets</a>
      </li>
      <li class="NavBar-item">
        <a href="/a-propos/" class="NavBar-link">À propos</a>
      </li>
    </ul>
  </nav>
</header>

  <main>
    <article class="Article">
      <header class="Article-header">
        <time class="Article-date">25 juin 2015</time>
        <h1 class="Article-title">Une gestion responsable des webfonts</h1>
      </header>
      <div class="Article-content  -articlePage">
        

<p>Jusqu&rsquo;à très récemment, j&rsquo;avais tendance à gérer mes webfonts de manière basique en les appelant directement dans mon CSS, que ce soit via CDN (Google webfonts) ou en hébergement personnel. Mais cette manière de faire est propice à l&rsquo;apparition du FOIT, qui peut être très pénalisant selon les navigateurs. Voici une solution que j&rsquo;ai mise en place dernièrement, et dont je suis pleinement satisfait.</p>

<hr />

<h2 id="quelques-précisions">Quelques précisions</h2>

<p>La notion de <em>FOIT</em> ne parlant pas à tout le monde, commençons par une petite explication&nbsp;: tant que votre navigateur n&rsquo;a pas téléchargé les <em>webfonts</em> de votre site, le texte ainsi stylé reste invisible pendant un certain temps avant que le navigateur décide d&rsquo;afficher les polices que vous avez définies par défaut. C&rsquo;est ce qu&rsquo;on appelle le <em>FOIT</em>, pour <em>Flash Of Invisible Text</em>.</p>

<p>Le problème, c&rsquo;est que ce temps varie selon les navigateurs; et s&rsquo;il reste raisonnable sur Chrome ou Firefox (de l&rsquo;ordre de 3 secondes), il peut aller jusqu&rsquo;à 30 secondes pour Safari iOS par exemple.</p>

<figure>
  <img src="/assets/img/webfonts-invision.jpg" alt="Exemple de site avec FOIT">
  <figcaption>Exemple de FOIT&nbsp;: sur ce site, il m'a fallu une dizaine de secondes pour pouvoir accéder au contenu - malgré ma connexion en WiFi.</figcaption>
</figure>

<p>Si l&rsquo;on considère en outre qu&rsquo;un site doit en moyenne se charger en 1 seconde avec une connexion rapide, ne pas pouvoir accéder au contenu du site avant 3 secondes n&rsquo;est de toute façon pas l&rsquo;idéal.</p>

<h2 id="la-solution-au-problème">La solution au problème</h2>

<p><a href="http://crocodillon.com/blog/non-blocking-web-fonts-using-localstorage">Plusieurs</a> <a href="http://jaicab.com/localFont/">techniques</a> ont émergé récemment, mais celle qui a retenu mon attention est celle mise en place par <a href="https://www.filamentgroup.com/lab/font-events.html">filament group</a>.</p>

<p>L&rsquo;idée est d&rsquo;utiliser par défaut les polices <em>websafe</em> (cf. <a href="http://www.cssfontstack.com/">CSS Font Stack</a>) et de prévoir une classe contenant les <em>webfonts</em>, par exemple&nbsp;:</p>

<pre><code class="css">body {
  font-family: Sans-serif;
}

.font-loaded {
  font-family: 'Open Sans', Sans-serif;
}</code></pre>

<p>On utilise ensuite le loader JS <a href="https://github.com/bramstein/fontfaceobserver">Font Face Observer</a> créé par <a href="https://twitter.com/bram_stein">Bram Stein</a> pour détecter le moment où toutes les <em>webfonts</em> seront loadées, et une fois que c&rsquo;est fait on ajoute notre classe <code>font-loaded</code>&nbsp;:</p>

<pre><code class="js">(function(w) {
  if (w.document.documentElement.className.indexOf('fonts-loaded') > -1) {
    return;
  }
  var fontA = new w.FontFaceObserver('Open Sans', {
    weight: 300
  });
  var fontB = new w.FontFaceObserver('Open Sans', {
    weight: 300,
    style: 'italic'
  });
  w.Promise
  .all([fontA.check(), fontB.check()])
  .then(function() {
    w.document.documentElement.className += ' fonts-loaded';
    localStorage.setItem('fontsLoaded', true);
  });
}(this));</code></pre>

<p>L&rsquo;approche de filament group privilégie l&rsquo;utilisation de cookies, mais quant à moi j&rsquo;ai préféré me rabattre sur <em>localStorage</em>. On crée avec celui-ci un item <code>fontsLoaded</code> grâce auquel on pourra ajouter dans notre <code>&lt;head&gt;</code> la classe <code>fonts-loaded</code> à notre html, comme ceci&nbsp;:</p>

<pre><code class="html">&lt;script&gt;
  if (localStorage.getItem('fontsLoaded')) {
    document.documentElement.className += ' fonts-loaded';
  }
&lt;/script&gt;</code></pre>

<p>Ainsi, tant que cet item sera encore présent dans notre <em>localStorage</em>, la classe en question sera appliquée avant le rendu de la page.</p>

<h2 id="une-future-alternative">Une future alternative</h2>

<p>L&rsquo;approche décrite ici me paraît pour l&rsquo;instant la plus efficace, en attendant une meilleure solution&hellip; Celle-ci pourrait bien venir de la proposition <em>CSS font-rendering</em> dont le but est de contrôler directement via CSS le comportement d&rsquo;affichage de nos <em>webfonts</em>. Je vous invite à consulter son <a href="https://github.com/KenjiBaheux/css-font-rendering">repo Github</a> pour de plus amples informations.</p>

      </div>
    </article>
  </main>
</div>


  <script src="/assets/js/bundle-3f973440.js"></script>
</body>

</html>

